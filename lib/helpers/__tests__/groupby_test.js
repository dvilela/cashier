const groupby = require('../groupby');

describe('groupby helper', () => {
  it('should group by month', () => {
    const data = [
      [1991111, '1991-11-15'],
      [199451, '1994-05-19'],
      [11, '2017-01-01'],
      [12, '2017-01-31'],
      [21, '2017-02-01'],
      [22, '2017-02-28'],
      [31, '2017-03-01'],
      [32, '2017-03-31'],
      [41, '2017-04-01'],
      [42, '2017-04-30'],
      [51, '2017-05-01'],
      [52, '2017-05-19'],
      [53, '2017-05-31'],
      [61, '2017-06-01'],
      [62, '2017-06-30'],
      [71, '2017-07-01'],
      [72, '2017-07-31'],
      [81, '2017-08-01'],
      [82, '2017-08-31'],
      [91, '2017-09-01'],
      [92, '2017-09-30'],
      [101, '2017-10-01'],
      [102, '2017-10-31'],
      [111, '2017-11-01'],
      [112, '2017-11-15'],
      [113, '2017-11-30'],
      [121, '2017-12-01'],
      [122, '2017-12-31'],
    ];
    const expected = {
      '1991-11-01T00:00:00Z': [ [1991111, '1991-11-15'] ],
      '1994-05-01T00:00:00Z': [ [199451, '1994-05-19'] ],
      '2017-01-01T00:00:00Z': [ [11, '2017-01-01'], [12, '2017-01-31'] ],
      '2017-02-01T00:00:00Z': [ [21, '2017-02-01'], [22, '2017-02-28'] ],
      '2017-03-01T00:00:00Z': [ [31, '2017-03-01'], [32, '2017-03-31'] ],
      '2017-04-01T00:00:00Z': [ [41, '2017-04-01'], [42, '2017-04-30'] ],
      '2017-05-01T00:00:00Z': [ [51, '2017-05-01'], [52, '2017-05-19'], [53, '2017-05-31'] ],
      '2017-06-01T00:00:00Z': [ [61, '2017-06-01'], [62, '2017-06-30'] ],
      '2017-07-01T00:00:00Z': [ [71, '2017-07-01'], [72, '2017-07-31'] ],
      '2017-08-01T00:00:00Z': [ [81, '2017-08-01'], [82, '2017-08-31'] ],
      '2017-09-01T00:00:00Z': [ [91, '2017-09-01'], [92, '2017-09-30'] ],
      '2017-10-01T00:00:00Z': [ [101, '2017-10-01'], [102, '2017-10-31'] ],
      '2017-11-01T00:00:00Z': [ [111, '2017-11-01'], [112, '2017-11-15'], [113, '2017-11-30'] ],
      '2017-12-01T00:00:00Z': [ [121, '2017-12-01'], [122, '2017-12-31'] ],
    };
    expect(
      groupby.month(data, (tuple) => tuple[1])
    ).toEqual(expected);
  });

  it('should group dates by month', () => {
    const dates = [ '1991-11-15', '1994-05-19' ];
    const expected = {
      '1991-11-01T00:00:00Z': ['1991-11-15'],
      '1994-05-01T00:00:00Z': ['1994-05-19']
    };
    expect(
      groupby.month(dates)
    ).toEqual(expected);
  });

  it('should group objects by month', () => {
    const objects = [
      { id: 1991111, date: '1991-11-15' },
      { id: 199451, date: '1994-05-19' }
    ];
    const expected = {
      '1991-11-01T00:00:00Z': [ { id: 1991111, date: '1991-11-15' } ],
      '1994-05-01T00:00:00Z': [ { id: 199451, date: '1994-05-19' } ]
    }
    expect(
      groupby.month(objects, (obj) => obj.date)
    ).toEqual(expected);
  });
});
